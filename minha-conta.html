<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Conta | String Flow</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="header-left">
            <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
            <div class="logo">String Flow</div>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="O que deseja procurar?">
            <button type="submit">üîç</button>
        </div>
        <div class="header-icons">
            <a href="minha-conta.html" class="account-icon">
                <img src="images/minha-conta.png" alt="Minha Conta" class="custom-icon"> <span>Minha Conta</span>
            </a>
            <a href="carrinho.html" class="cart-icon">
                <img src="images/carrinho.png" alt="Carrinho de Compras" class="custom-icon">
                <span class="cart-count">0</span>
            </a>
        </div>
    </header>

    <div id="sidebar" class="sidebar">
        <span class="close-btn" onclick="toggleMenu()">&times;</span>
        <nav>
            <ul>
                <li><a href="index.html">In√≠cio</a></li>
                <li><a href="servicos.html">Servi√ßos</a></li>
                <li><a href="contato.html">Contato</a></li>
                <li><a href="minha-conta.html">Minha Conta</a></li>
                <li><a href="carrinho.html">Carrinho</a></li>
            </ul>
        </nav>
    </div>

    <main class="content">
        <section class="account-section">
            <h2 style="color: var(--cor-principal);">Minha Conta</h2>
            
            <!-- Conte√∫do para login (vis√≠vel por padr√£o) -->
            <div id="login-container">
                <p>Fa√ßa login para acessar seu perfil e hist√≥rico de pedidos.</p>
                <div class="form-tabs">
                    <button class="tab-button active" onclick="showForm('login')">Entrar</button>
                    <button class="tab-button" onclick="showForm('register')">Cadastrar</button>
                </div>

                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-email">E-mail</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Senha</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="submit-btn">Confirmar</button>
                </form>

                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-email">E-mail</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Senha</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirmar Senha</label>
                        <input type="password" id="register-confirm-password" required>
                    </div>
                    <button type="submit" class="submit-btn">Confirmar</button>
                </form>

                <p class="separator">- OU -</p>

                <a href="/auth/google" class="google-login-button">
                    <img src="images/Icone Login Google.png" alt="√çcone Google" class="google-icon">
                    <span>Entrar com Google</span>
                </a>
            </div>

            <!-- Conte√∫do para perfil (oculto por padr√£o) -->
            <div id="profile-container" style="display: none;">
                <p>Bem-vindo(a) de volta!</p>
                <div class="profile-info-container">
                    <img id="profile-picture" src="https://placehold.co/150x150/1A1A1A/F0F0F0?text=üë§" alt="Foto de Perfil" class="profile-picture">
                    <h3 id="profile-name"></h3>
                    <!-- A linha do cargo foi removida daqui -->
                    <button id="edit-profile-btn" class="submit-btn">Editar Perfil</button>
                    <button id="logout-btn" class="submit-btn logout-btn">Sair</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 String Flow. Todos os direitos reservados.</p>
            <address class="footer-address">
                Rua dos Instrumentos, 123 - Centro <br>
                S√£o Paulo, SP - Brasil
            </address>
            <div class="footer-links">
                <a href="termos.html">Termos de Servi√ßo</a> | <a href="privacidade.html">Pol√≠tica de Privacidade</a>
            </div>
        </div>
    </footer>

    <script>
        // Fun√ß√µes para alternar entre os formul√°rios de login e cadastro
        function showForm(formId) {
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(`${formId}-form`).classList.add('active');
            document.querySelector(`.tab-button[onclick="showForm('${formId}')"]`).classList.add('active');
        }

        // Fun√ß√£o para alternar o menu lateral
        window.toggleMenu = function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.width = sidebar.style.width === '250px' ? '0' : '250px';
        };

        // Fun√ß√£o para verificar o estado do usu√°rio ao carregar a p√°gina
        async function checkUserStatus() {
            try {
                const response = await fetch('/user-status');
                const data = await response.json();

                const loginContainer = document.getElementById('login-container');
                const profileContainer = document.getElementById('profile-container');

                if (data.isLoggedIn) {
                    loginContainer.style.display = 'none';
                    profileContainer.style.display = 'block';
                    
                    document.getElementById('profile-name').innerText = data.displayName || 'Usu√°rio';
                    const profilePicture = document.getElementById('profile-picture');
                    profilePicture.src = data.photo || 'https://placehold.co/150x150/1A1A1A/F0F0F0?text=üë§';
                    profilePicture.onerror = () => {
                        profilePicture.src = 'https://placehold.co/150x150/1A1A1A/F0F0F0?text=üë§';
                    };
                } else {
                    loginContainer.style.display = 'block';
                    profileContainer.style.display = 'none';
                }
            } catch (error) {
                console.error('Erro ao verificar o status do usu√°rio:', error);
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('profile-container').style.display = 'none';
            }
        }
        
        document.getElementById('logout-btn').addEventListener('click', () => {
            window.location.href = '/logout';
        });

        document.addEventListener('DOMContentLoaded', checkUserStatus);
    </script>
</body>
</html>
