<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minha Conta | String Flow</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
ย ย .account-section { display: flex; flex-direction: column; align-items: center; gap: 2rem; max-width: 500px; margin: 5rem auto; padding: 2rem; background-color: var(--cor-fundo-conteudo); border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-align: center; }
ย ย .auth-form { display: none; flex-direction: column; gap: 1rem; width: 100%; }
ย ย .auth-form.active { display: flex; }
ย ย .profile-info-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
ย ย #profile-picture { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--cor-principal); }
ย ย .submit-btn { width: 200px; max-width: 100%; margin-top: 0.5rem; }
ย ย #admin-panel-link { display: none; margin-top: 1rem; }
</style>
</head>
<body>

<header>
ย ย <div class="header-left">
ย ย ย ย <div class="menu-toggle" onclick="toggleMenu()">โฐ</div>
ย ย ย ย <div class="logo">String Flow</div>
ย ย </div>
ย ย <div class="search-bar">
ย ย ย ย <input type="text" placeholder="O que deseja procurar?">
ย ย ย ย <button type="submit">๐</button>
ย ย </div>
ย ย <div class="header-icons">
ย ย ย ย <a href="minha-conta.html" class="account-icon">
ย ย ย ย ย ย <img src="images/minha-conta.png" alt="Minha Conta" class="custom-icon"> <span>Minha Conta</span>
ย ย ย ย </a>
ย ย ย ย <a href="carrinho.html" class="cart-icon">
ย ย ย ย ย ย <img src="images/carrinho.png" alt="Carrinho de Compras" class="custom-icon">
ย ย ย ย ย ย <span class="cart-count">0</span>
ย ย ย ย </a>
ย ย </div>
</header>

<div id="sidebar" class="sidebar">
ย ย <span class="close-btn" onclick="toggleMenu()">&times;</span>
ย ย <nav>
ย ย ย ย <ul>
ย ย ย ย ย ย <li><a href="index.html">Inรญcio</a></li>
ย ย ย ย ย ย <li><a href="instrumentos.html">Instrumentos</a></li>
ย ย ย ย ย ย <li><a href="acessorios.html">Acessรณrios</a></li>
ย ย ย ย ย ย <li><a href="contato.html">Contato</a></li>
ย ย ย ย ย ย <li><a href="minha-conta.html">Minha Conta</a></li>
ย ย ย ย ย ย <li><a href="carrinho.html">Carrinho</a></li>
ย ย ย ย </ul>
ย ย </nav>
</div>

<main class="content">
ย ย <section class="account-section">
ย ย ย ย <h2 style="color: var(--cor-principal);">Minha Conta</h2>

ย ย ย ย ย ย ย ย <div id="login-container">
ย ย ย ย ย ย <p>Faรงa login para acessar seu perfil e histรณrico de pedidos.</p>
ย ย ย ย ย ย <div class="form-tabs">
ย ย ย ย ย ย ย ย <button class="tab-button active" onclick="showForm('login')">Entrar</button>
ย ย ย ย ย ย ย ย <button class="tab-button" onclick="showForm('register')">Cadastrar</button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <form id="login-form" class="auth-form active">
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="login-email">E-mail</label>
ย ย ย ย ย ย ย ย ย ย <input type="email" id="login-email" name="email" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="login-password">Senha</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="login-password" name="password" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button type="submit" class="submit-btn">Confirmar</button>
ย ย ย ย ย ย </form>

ย ย ย ย ย ย ย ย ย ย ย ย <form id="register-form" class="auth-form">
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="register-displayName">Nome</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="register-displayName" name="displayName" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="register-email">E-mail</label>
ย ย ย ย ย ย ย ย ย ย <input type="email" id="register-email" name="email" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="register-password">Senha</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="register-password" name="password" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="register-confirm-password">Confirmar Senha</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="register-confirm-password" name="confirmPassword" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button type="submit" class="submit-btn">Confirmar</button>
ย ย ย ย ย ย </form>

ย ย ย ย ย ย <p class="separator">- OU -</p>
ย ย ย ย ย ย <a href="https://backend-fk1s.onrender.com/auth/google" class="google-login-button">
ย ย ย ย ย ย ย ย <img src="images/Icone Login Google.png" alt="รcone Google" class="google-icon">
ย ย ย ย ย ย ย ย Entrar com Google
ย ย ย ย ย ย </a>
ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="profile-container" style="display: none;">
ย ย ย ย ย ย <div class="profile-info-container">
ย ย ย ย ย ย ย ย <img id="profile-picture" src="https://placehold.co/150x150/1A1A1A/F0F0F0?text=๐ค" alt="Foto de Perfil">
ย ย ย ย ย ย ย ย <h3 id="profile-name"></h3>
ย ย ย ย ย ย ย ย <div id="admin-panel-link">
ย ย ย ย ย ย ย ย ย ย <a href="painel.html" class="cta-button">Painel Administrativo</a>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button id="edit-profile-btn" class="submit-btn">Editar Perfil</button>
ย ย ย ย ย ย ย ย <button id="logout-btn" class="submit-btn logout-btn">Sair</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </section>
</main>

<footer>
ย ย <div class="footer-content">
ย ย ย ย <p>&copy; 2024 String Flow. Todos os direitos reservados.</p>
ย ย ย ย <address class="footer-address">
ย ย ย ย ย ย Rua dos Instrumentos, 123 - Centro <br>
ย ย ย ย ย ย Sรฃo Paulo, SP - Brasil
ย ย ย ย </address>
ย ย ย ย <div class="footer-links">
ย ย ย ย ย ย <a href="termos.html">Termos de Serviรงo</a> | <a href="privacidade.html">Polรญtica de Privacidade</a>
ย ย ย ย </div>
ย ย </div>
</footer>

<script>
ย ย function showForm(formId){
ย ย ย ย document.querySelectorAll('.auth-form').forEach(f => f.style.display = 'none');
ย ย ย ย document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
ย ย ย ย document.getElementById(`${formId}-form`).style.display = 'flex';
ย ย ย ย document.querySelector(`.tab-button[onclick="showForm('${formId}')"]`).classList.add('active');
ย ย }

ย ย window.toggleMenu = function(){
ย ย ย ย const sidebar = document.getElementById('sidebar');
ย ย ย ย sidebar.style.width = sidebar.style.width === '250px' ? '0' : '250px';
ย ย };

ย ย async function checkUserStatus(){
ย ย ย ย try{
ย ย ย ย ย ย const res = await fetch('https://backend-fk1s.onrender.com/user-status');
ย ย ย ย ย ย const data = await res.json();
ย ย ย ย ย ย const loginContainer = document.getElementById('login-container');
ย ย ย ย ย ย const profileContainer = document.getElementById('profile-container');
ย ย ย ย ย ย const adminPanel = document.getElementById('admin-panel-link');

ย ย ย ย ย ย if(data.isLoggedIn){
ย ย ย ย ย ย ย ย loginContainer.style.display = 'none';
ย ย ย ย ย ย ย ย profileContainer.style.display = 'flex';
ย ย ย ย ย ย ย ย document.getElementById('profile-name').innerText = data.displayName || 'Usuรกrio';
ย ย ย ย ย ย ย ย document.getElementById('profile-picture').src = data.photo || 'https://placehold.co/150x150/1A1A1A/F0F0F0?text=๐ค';
ย ย ย ย ย ย ย ย if(data.role==='admin') adminPanel.style.display = 'block';
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย loginContainer.style.display = 'block';
ย ย ย ย ย ย ย ย profileContainer.style.display = 'none';
ย ย ย ย ย ย ย ย adminPanel.style.display = 'none';
ย ย ย ย ย ย ย ย showForm('login');
ย ย ย ย ย ย }
ย ย ย ย }catch(e){
ย ย ย ย ย ย console.error('Erro ao verificar usuรกrio', e);
ย ย ย ย ย ย showForm('login');
ย ย ย ย }
ย ย }

ย ย // Login com fetch
ย ย document.getElementById('login-form').addEventListener('submit', async e => {
ย ย ย ย e.preventDefault();
ย ย ย ย const email = e.target.email.value;
ย ย ย ย const password = e.target.password.value;
ย ย ย ย try{
ย ย ย ย ย ย const res = await fetch('https://backend-fk1s.onrender.com/login', {
ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย headers: {'Content-Type':'application/json'},
ย ย ย ย ย ย ย ย body: JSON.stringify({email, password})
ย ย ย ย ย ย });
ย ย ย ย ย ย if(res.ok){
ย ย ย ย ย ย ย ย checkUserStatus();
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย alert(await res.text());
ย ย ย ย ย ย }
ย ย ย ย }catch(err){
ย ย ย ย ย ย console.error(err);
ย ย ย ย ย ย alert('Erro ao logar');
ย ย ย ย }
ย ย });

ย ย // Cadastro com fetch
ย ย document.getElementById('register-form').addEventListener('submit', async e => {
ย ย ย ย e.preventDefault();
ย ย ย ย const displayName = e.target.displayName.value;
ย ย ย ย const email = e.target.email.value;
ย ย ย ย const password = e.target.password.value;
ย ย ย ย const confirmPassword = e.target.confirmPassword.value;

ย ย ย ย if(password !== confirmPassword){
ย ย ย ย ย ย alert('As senhas nรฃo conferem');
ย ย ย ย ย ย return;
ย ย ย ย }

ย ย ย ย try{
ย ย ย ย ย ย // โ๏ธ CORRIGIDO: Agora a chamada de cadastro tambรฉm usa o URL completo do Render
ย ย ย ย ย ย const res = await fetch('https://backend-fk1s.onrender.com/register', {
ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย headers: {'Content-Type':'application/json'},
ย ย ย ย ย ย ย ย body: JSON.stringify({displayName, email, password})
ย ย ย ย ย ย });
ย ย ย ย ย ย if(res.ok){
ย ย ย ย ย ย ย ย checkUserStatus();
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย alert(await res.text());
ย ย ย ย ย ย }
ย ย ย ย }catch(err){
ย ย ย ย ย ย console.error(err);
ย ย ย ย ย ย alert('Erro ao cadastrar');
ย ย ย ย }
ย ย });

ย ย document.getElementById('logout-btn').addEventListener('click', ()=> window.location.href = 'https://backend-fk1s.onrender.com/logout');

ย ย document.addEventListener('DOMContentLoaded', checkUserStatus);
</script>

</body>
</html>
